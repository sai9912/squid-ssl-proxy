															 
http_port 10.0.45.192:8000 ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB cert=/etc/squid-cert/private.pem key=/etc/squid-cert/private.pem name=ip01

# Route egress to match inbound listener
acl to_ip01 myportname ip01

										 
									  
																   
																	  

tcp_outgoing_address 10.0.45.192 to_ip01
# should be allowed


					  
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 21          # ftp
acl Safe_ports port 443         # https
acl Safe_ports port 70          # gopher
acl Safe_ports port 210         # wais
acl Safe_ports port 1025-65535  # unregistered ports
acl Safe_ports port 280         # http-mgmt
acl Safe_ports port 488         # gss-http
acl Safe_ports port 591         # filemaker
acl Safe_ports port 777         # multiling http
acl CONNECT method CONNECT

												  
														   

																	   
acl deny_cache_url urlpath_regex -i \
    MASTERS/HOME\.aspx/CALLSMSLOGINREG \
    MASTERS/HOME\.aspx/CALLREGLOGIN \
    Masters/Home\.aspx/CALLSMSLOGINREG \
    Masters/Home\.aspx/CALLREGLOGIN \
    NEWBOOKING\.aspx/CallSMS \
    NEWBOOKING\.aspx/CallRegister \
    NEWBOOKING\.aspx/lnkCRefreshs \
    NEWBOOKING\.aspx/ChangeVehicleNo \
    NEWBOOKING\.aspx/PopulateDelMandals \
    NEWBOOKING\.aspx/rdselstckpoint \
    NEWBOOKING\.aspx/PopulateGrid \
    BOOKINGHOME\.aspx \
    CALLREGLOGIN \
    CALLSMSLOGINREG

# Prevent Squid from adding proxy headers
via off
forwarded_for delete
request_header_access Via deny all
request_header_access X-Forwarded-For deny all
request_header_access Proxy-Connection deny all
request_header_access Cache-Control deny all
#
# Recommended minimum Access Permission configuration:
#
# Deny requests to certain unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# This default configuration only allows localhost requests because a more
# permissive Squid installation could introduce new attack vectors into the
# network by proxying external TCP connections to unprotected services.
http_access allow all

# The two deny rules below are unnecessary in this default configuration
# because they are followed by a "deny all" rule. However, they may become
# critically important when you start allowing external requests below them.
						  

# Protect web applications running on the same server as Squid. They often
# assume that only local users can access them at "localhost" ports.
#http_access deny to_localhost

# Protect cloud servers that provide local users with sensitive info about
# their server via certain well-known link-local (a.k.a. APIPA) addresses.
#http_access deny to_linklocal

#
# INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS
#

# Example rule allowing access from your local networks.
# Adapt localnet in the ACL section to list your (internal) IP networks
# from where browsing should be allowed

# And finally deny all other access to this proxy
always_direct allow deny_cache_url
							  

# Deny caching for sensitive POST URLs
cache deny deny_cache_url




ssl_bump server-first all
#always_direct allow all
sslcrtd_program /usr/lib/squid/security_file_certgen -s /var/lib/ssl_db -M 4MB
sslcrtd_children 1000 startup=1 idle=1

# Uncomment and adjust the following to add a disk cache directory.
				
									

											  
					  
												  
					  
cache_dir ufs /var/cache/squid 100 16 256

# Leave coredumps in the first cache dir
coredump_dir /var/cache/squid

#
# Add any of your own refresh_pattern entries above these.
#
# ---- Static asset rules (hard-reload-proof) ----
refresh_pattern -i \.png$       10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i \.jpg$       10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i \.jpeg$      10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i \.gif$       10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i \.ico$       10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i \.css$       10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i \.js$        10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i \.min\.js$   10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate

# Be very careful with dynamic handlers; only keep this if you are 100% sure they are immutable and public
refresh_pattern -i \.axd(\?.*)?$ 10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate
refresh_pattern -i /Masters/Uptime\.aspx$ 10080 100% 10080 override-expire ignore-no-cache ignore-private ignore-reload ignore-must-revalidate

															 
																																				
																											  
																									   
										
refresh_pattern . 30 20% 4320 reload-into-ims

				   
						   
						
				   

range_offset_limit 200 MB
maximum_object_size 200 MB
quick_abort_min -1

connect_timeout 200 seconds
				 
connect_retries 10
forward_timeout 200 seconds         # overall cap for upstream attempt(s)
forward_max_tries 100               # total tries across peers/origins
retry_on_error on                  # Retry failed requests (including POSTs if safe)


read_timeout 200 seconds

pipeline_prefetch 10



logformat istlog %{%Y-%m-%dT%H:%M:%S}tl %>a %Ss/%03>Hs %rm %ru %Sh/%<a
access_log /var/log/squid/access.log istlog
